<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>traefik-ingress配置https（已实践）</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->
<style id="wiz_custom_css">html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 15px;            padding: 1.33rem 1rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code {            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            padding: 0 12px;            padding: 0 0.8rem;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td, th {            padding: 4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;			        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                padding: 0 0.9375rem;            }        }</style></head>

<body spellcheck="false" ><div><p style="box-sizing: border-box; margin-top: 30px; margin-bottom: 30px; color: rgb(64, 64, 64); font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><span style="line-height: 1.6;">目前所有的访问都已经转向https了，大势所趋，ssl重要性这里不细说了；我这里是client到traefik加密，后端还是http，有更高要求的时候再来进步优化，先满足功能再说。</span><br></p><blockquote style="box-sizing: border-box; padding: 10px 20px; margin-top: 20px; margin-bottom: 20px; font-size: 0.95em; border-left-width: 5px; border-left-style: solid; border-left-color: rgb(238, 238, 238); color: gray; font-style: italic; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><p style="box-sizing: border-box;">traefik http部署我这里省略，详细可参考<a href="https://github.com/gjmzj/kubeasz" style="box-sizing: border-box; background-color: transparent; color: rgb(51, 122, 183); text-decoration: none;">kubeasz</a>中的ingress部分。</p></blockquote><h2 id="流程示意图" style="box-sizing: border-box; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; line-height: 1.1; color: rgb(64, 64, 64); margin-top: 30px; margin-bottom: 10px; font-size: 30px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);">流程示意图</h2><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 6px 10px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; border: 1px solid rgb(204, 204, 204); border-radius: 3px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(248, 248, 248);"><code class="language-bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; padding: 0px; color: inherit; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">client ---https---&gt; traefik ---http---&gt; svc (本文)
client ---https---&gt; traefik ---https---&gt; svc
</code></pre><h2 id="生成证书" style="box-sizing: border-box; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; line-height: 1.1; color: rgb(64, 64, 64); margin-top: 30px; margin-bottom: 10px; font-size: 30px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);">一、生成证书</h2><blockquote style="box-sizing: border-box; padding: 10px 20px; margin-top: 20px; margin-bottom: 20px; font-size: 0.95em; border-left-width: 5px; border-left-style: solid; border-left-color: rgb(238, 238, 238); color: gray; font-style: italic; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><p style="box-sizing: border-box;">我这里使用私签证书,CN是域名，根据实际需求填写</p></blockquote><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 6px 10px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; border: 1px solid rgb(204, 204, 204); border-radius: 3px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(248, 248, 248);"><code class="language-bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; padding: 0px; color: inherit; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><pre id="__code_19"><code class="shell hljs"><b>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=<span data-wiz-span="data-wiz-span" style="color: rgb(255, 0, 0);">traefik-ui.minikube</span>"</b></code></pre></code></pre><h2 id="新增cm" style="box-sizing: border-box; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; line-height: 1.1; color: rgb(64, 64, 64); margin-top: 30px; margin-bottom: 10px; font-size: 30px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 51); font-family: 'Microsoft YaHei'; font-size: 16px; line-height: 1.6;">二、创建一个configmap，保存traefix的配置。这里的traefix中配置了把所有http请求全部rewrite为https的规则，并配置相应的证书位置</span></h2><pre style="box-sizing: border-box; overflow: auto; padding: 6px 10px; margin-top: 0px; margin-bottom: 10px; word-break: break-all; word-wrap: break-word; border: 1px solid rgb(204, 204, 204); border-radius: 3px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(248, 248, 248);"><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font color="rgba(0, 0, 0, 0)" face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="line-height: 1.42857;">1、配置证书traefik-cert cm
</span></font><pre id="__code_19"><code class="shell hljs" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857;"><b>kubectl -n kube-system create secret tls&nbsp;</b></code><span style="background-color: transparent; line-height: 21.4286px;"><b>traefik-ingress-controller-default-cert</b></span><b style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; background-color: transparent;"> --key=tls.key --cert=tls.crt</b></pre><code class="language-bash" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">2、查看证书并且导入到yaml文件</code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font color="#333333" face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="font-size: 13px; line-height: 18.5714px;">kubectl get secret&nbsp;</span></font><span style="background-color: transparent; font-size: 13px; line-height: 18.5714px;"><font color="#333333" face="Menlo, Monaco, Consolas, Courier New, monospace">traefik-ingress-controller-default-cert</font></span><span style="font-size: 13px; line-height: 18.5714px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; background-color: transparent;"> -o yaml &gt;&gt; secret.yaml</span></code><div style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857;">3、复制tls.crt和tls.key的值到traefik-ingress.yaml</div><div style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857;"><img src="traefik-ingress配置https（已实践）_files/df0da7aa-282e-4789-a046-b8d4bea11062.png" border="0"><div>&nbsp;</div></div><font face="Menlo, Monaco, Consolas, Courier New, monospace"><font color="rgba(0, 0, 0, 0)"><span style="line-height: 1.42857;"><span data-wiz-span="data-wiz-span" style="color: rgb(0, 0, 0);">4、配置https重定向配置文件</span></span></font></font></code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="line-height: 1.42857;">注意:如果修改了cmp配置，需要停止pod重新启动才生效</span></font></code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="line-height: 21.4286px;">kubectl delete -f traefik-ingress.yaml&nbsp;</span></font></code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font face="Menlo, Monaco, Consolas, Courier New, monospace">配置文件内容如下:
[root@by-deploy01 ingress]# cat traefik.yaml
</font><span style="color: rgb(186, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; line-height: 21.4286px;">kind: ConfigMap
metadata:
  name: traefik-ingress-controller-config-map
  namespace: kube-system</span><font face="Menlo, Monaco, Consolas, Courier New, monospace"><font color="#ba0000"><span style="line-height: 21.4286px;"><br></span></font></font></code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font face="Menlo, Monaco, Consolas, Courier New, monospace"><font color="#ba0000"><span style="line-height: 21.4286px;">apiVersion: v1
data:
  traefik.toml: |+
    logLevel = "INFO"
    defaultEntryPoints = ["http","https"]
    [entryPoints]
      [entryPoints.http]
      address = ":80"
        [entryPoints.http.redirect]
        entryPoint = "https"
      [entryPoints.https]
      address = ":443"
        [entryPoints.https.tls]
          [[entryPoints.https.tls.certificates]]
          certFile = "/ssl/tls.crt"
          keyFile = "/ssl/tls.key"
      [entryPoints.traefik]
      address = ":8080"</span></font></font></code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font face="Menlo, Monaco, Consolas, Courier New, monospace"><font color="#ba0000"><span style="line-height: 21.4286px;">      </span></font></font><span style="color: rgb(186, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; line-height: 21.4286px;">[entryPoints.traefik]
      address = ":8000"</span><font face="Menlo, Monaco, Consolas, Courier New, monospace"><font color="#ba0000"><span style="line-height: 21.4286px;">
     [kubernetes]
     [traefikLog]
          format = "json"
     [api]
          entryPoint = "traefik"
          dashboard = true

</span></font></font></code><code class="language-bash" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">##<span style="color: rgb(79, 79, 79); font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; white-space: normal; line-height: 1.42857; background-color: rgb(255, 255, 255);">其中tls.crt和tls.key就是证书文件，注意必须要改为这个文件名。</span></code><code class="language-bash" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">
# 配置traefik-conf cm</code><code class="language-bash" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="line-height: 21.4286px;">kubectl apply -f traefik.yaml</span></font><font color="rgba(0, 0, 0, 0)" face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="line-height: 1.42857;"><br></span></font></code><code class="language-bash" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">如果是toml文件就用下列命令：
kubectl create configmap traefik-conf --from-file=traefik.toml -n kube-system
##查看</code><code class="language-bash" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">kubectl get cm -n kube-system
</code></pre><h2 id="deploy引用" style="box-sizing: border-box; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; line-height: 1.1; color: rgb(64, 64, 64); margin-top: 30px; margin-bottom: 10px; font-size: 30px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><span data-wiz-span="data-wiz-span" style="font-size:1.133rem;font-weight:normal;color:rgb(0, 0, 0)">的在traefik.toml里面定义了端口重定向，如果没设置对应端口https重定向无效，如下图：<img src="traefik-ingress配置https（已实践）_files/1eb5f1d6-089e-4542-951f-a0f655049073.png" border="0" class=""></span></h2><h2 id="deploy引用" style="box-sizing: border-box; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; line-height: 1.1; color: rgb(64, 64, 64); margin-top: 30px; margin-bottom: 10px; font-size: 30px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><span data-wiz-span="data-wiz-span" style="font-size: 1.133rem; font-weight: normal; color: rgb(255, 0, 0);">注意：配置文件的目录和证书的目录不能一样</span></h2><h2 id="deploy引用" style="box-sizing: border-box; font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; line-height: 1.1; color: rgb(64, 64, 64); margin-top: 30px; margin-bottom: 10px; font-size: 30px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);">deploy引用</h2><pre style="box-sizing: border-box; overflow: auto; padding: 6px 10px; margin-top: 0px; margin-bottom: 10px; word-break: break-all; word-wrap: break-word; border: 1px solid rgb(204, 204, 204); border-radius: 3px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(248, 248, 248);"><code class="language-yaml" style="box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><font color="#333333" face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="font-size: 13px; line-height: 18.5714px;">kind: Deployment
apiVersion: apps/v1beta1
metadata:
  name: traefik-ingress-controller
  namespace: kube-system
  labels:
    k8s-app: traefik-ingress-lb
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: traefik-ingress-lb
  template:
    metadata:
      labels:
        k8s-app: traefik-ingress-lb
        name: traefik-ingress-lb
    spec:
      serviceAccountName: traefik-ingress-controller
      terminationGracePeriodSeconds: 60
      containers:
      - image: traefik:v1.7.2
        imagePullPolicy: IfNotPresent
        name: traefik-ingress-lb
<b>#修改了之前的内容</b>
        <span data-wiz-span="data-wiz-span" style="color: rgb(255, 0, 0);">volumeMounts:<br>        - mountPath: /config<br>          name: config<br>        - mountPath: /ssl<br>          name: ssl<br>        - mountPath: /etc/localtime<br>          name: time<br>        ports:<br>        - name: http<br>          containerPort: 80<br>          hostPort: 80<br>          protocol: TCP<br>        - name: https<br>          containerPort: 443<br>          hostPort: 443<br>          protocol: TCP<br>        - name: traefik-web<br>          containerPort: 8080<br>          hostPort: 8080<br>          protocol: TCP<br>        args:<br>        - --configfile=/config/traefik.toml<br>      volumes:<br>      - name: config<br>        configMap:<br>          name: traefik-ingress-controller-config-map<br>      - name: ssl<br>        secret:<br>          secretName: traefik-ingress-controller-default-cert<br>      - name: time<br>        hostPath:<br>          path: /etc/localtime</span>
<b># 修改结束</b>
</span></font><font color="rgba(0, 0, 0, 0)" face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="line-height: 1.42857;">
<span data-wiz-span="data-wiz-span" style="color: rgb(0, 0, 0);">---<br>kind: Service</span></span></font></code><code class="language-yaml" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;">.....          
# 生效
  kubectl apply -f traefik_deploy.yaml</code><code class="language-yaml" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857; box-sizing: border-box; padding: 0px; border-radius: 0px; display: block; width: auto; word-wrap: normal; background-color: transparent;"><span style="color: rgb(64, 64, 64); font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; line-height: 1.6; background-color: rgb(255, 255, 255);">至此配置完成可以用浏览器测试下！</span></code></pre><p style="box-sizing: border-box; margin-top: 30px; margin-bottom: 30px; color: rgb(64, 64, 64); font-family: -apple-system, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'Microsoft JhengHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 51); font-family: 'Microsoft YaHei'; font-variant-ligatures: normal;"><span data-wiz-span="data-wiz-span" style="font-size: 0.867rem;">最后我们来测试下是否成功，这里我们可以登陆traefik-ui界面，可以看到原本http的访问，traefik会直接给我们重定向至https。</span></span><br></p><div style="color:gray">输入jtcf.ingress.com::23456</div><div style="color:gray"><img src="traefik-ingress配置https（已实践）_files/51ddcab0-59cf-4de0-b2ad-a030f462ac1b.png" border="0" class=""><div>&nbsp;</div></div><div style="color:gray">自动重定向到https</div><div><font color="#808080"><img src="traefik-ingress配置https（已实践）_files/28e6994c-41a4-424e-a6fe-58a021ff5e4c.png" border="0"></font><div style="color: gray;">&nbsp;注意：如果在ingress上开启了tls，那么证书必须与域名相关</div><div style="color: gray;"><img src="traefik-ingress配置https（已实践）_files/5c842ba5-0973-4012-92c0-ce643c246dea.png" border="0"><div>&nbsp;在ingress上不开启tls则使用的是默认证书，下面是注释了tls</div></div><div style="color: gray;"><img src="traefik-ingress配置https（已实践）_files/cc087b42-28b0-4a0b-a323-152975c5dc45.png" border="0" class=""><div>&nbsp;<b><span data-wiz-span="data-wiz-span" style="color: rgb(255, 0, 0);">证书必须和ingress在一个命名空间</span>，不然无法访问，报错如下：比如我们证书是在kube-system</b></div></div><div style="color: gray;"><img src="traefik-ingress配置https（已实践）_files/2c0e4810-6d35-4e17-8395-bfc260a3973b.png" border="0" class=""><div>&nbsp;Error configuring TLS for ingress default/my-ingress: secret <span data-wiz-span="data-wiz-span" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="color: rgb(255, 0, 0);">default/</span>traefik-ingress-controller-default-cert </span>does not exist</div></div><div style="color: gray;"><br></div><div style="color: gray;">单独创建证书只需要执行：</div><div><pre id="__code_19" style="orphans: 2; widows: 2; background-color: rgb(248, 248, 248);"><code class="shell hljs" style="color: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; line-height: 1.42857;"><b>kubectl -n default create secret tls&nbsp;</b></code><span style="line-height: 21.4286px;"><b>nginx-secret</b></span><b style="color: inherit; font-size: inherit; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; line-height: 1.42857; background-color: transparent;"> --key=tls.key --cert=tls.crt</b></pre></div><div style="color: gray;">创建好之后直接在ingress填写证书名称就可以使用</div><div style="color: gray;">下面是我单独创建了一根default空间的证书给Ingress使用</div></div><div style="color: gray;"><img src="traefik-ingress配置https（已实践）_files/4bdbe126-ef30-4f51-a690-157e7ec2d514.png" border="0"><div>&nbsp;</div></div><div style="color:gray">或者把证书创建与ingress放一个yaml：</div><div style="color:gray">Secret:</div><div style="color:gray"><img src="traefik-ingress配置https（已实践）_files/21e49045-730a-40c7-bd2b-20f63ce960b9.png" border="0"><div>&nbsp;ingress：</div></div><img src="traefik-ingress配置https（已实践）_files/f247320a-ec21-40c7-a58b-a5769396228b.png" border="0"><div>&nbsp;</div><div style="color:gray"><br><div>&nbsp;</div></div><p></p></div></body></html>